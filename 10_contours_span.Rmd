---
title: "Vowel contours for Spanish data"
author: "Annie Helms (annie_helms@berkeley.edu)"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output:
  html_document:
    toc: true
    toc_float: true
editor_options: 
  chunk_output_type: inline
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, root.dir = "/Users/Annie/Box Sync/PhD/contour_practice/")
```

In order to create vowel contours (aka formant trajectories) for Spanish vowels, install the package `speakr` (https://github.com/stefanocoretta/speakr) to run Praat scripts from R and read the output here. This will be useful for extracting formant measurements.

```{r warning = FALSE, message = FALSE}
# run this cell to install package `speakr` used for implementation of Praat script from within R
# install.packages("speakr")
```

Following the methodology laid out in Fruewahld (2010) (https://www.ling.upenn.edu/~joseff/papers/fruehwald_ssanova.pdf), install the package `gss` to fit the Smoothing Spline ANOVA (SS-ANOVA) to the resulting formant data. 

```{r warning = FALSE, message = FALSE}
# run this cell to install package `gss`
# install.packages("gss")
```
Install necessary libraries:

```{r message = FALSE, warning = FALSE}
library(dplyr) # manipulating data frames
library(ggplot2) # making visualizations
library(kableExtra) # formats dataframes in html output
library(speakr) # run Praat script from within R
library(gss) #SS-ANOVA
```

In order to extract formant measures from the DIMEx100 and CBAS corpora, we can use the Praat script `get_formants` from Mietta Lennes (2003). This script contains a form, so we need to define the variables requested and pass them into `speakr`'s `praat_run` command.

The required information, in order, is:
1. directory of sound files
2. sound file extension
3. directory of TextGrid files
4. TextGrid file extension
5. full path of resulting text file (with formant measures)
6. name of tier to analyze
7. time step (0.01 is default)
8. max number of formants (5)
9. max formant frequency (generally 5500 Hz for females and 5000 Hz for males)
10. window length (0.025 is default)
11. preemphasis from Hz (default is 50)

Save location of script:

```{r message = FALSE, echo = FALSE}
setwd("/Users/Annie/Box Sync/PhD/contour_practice/")
```

```{r}
script = "get_formant_contour.Praat"
```

```{r}
# create and define variables for each parameter of the Praat script form
sound_dir = "C:/Users/Annie/Box Sync/PhD/contour_practice/"
sound_ext = ".wav"
tg_dir = "C:/Users/Annie/Box Sync/PhD/contour_practice/"
tg_ext = ".TextGrid"
result_path = "C:/Users/Annie/Box Sync/PhD/contour_practice/formants.txt"
tier = "phone"
step = 0.01
max_num = 5
max_hz = 5500
win = 0.025
emph = 50
```

Now run, adding in parameters as defined above.

```{r}
praat_run(script, sound_dir, sound_ext, tg_dir, tg_ext, result_path, tier, step, max_num, max_hz, win, emph)
```


```{r}
script <- system.file("extdata", "get-formants-args.praat", package = "speakr")

formants <- praat_run(script, "Hertz", 0.03, capture = TRUE) %>%
  read_csv()
```
